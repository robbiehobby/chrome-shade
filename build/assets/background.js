import{d as o}from"./chrome.js";async function n(t){const e=await chrome.tabs.query({url:`*://${t.website.hostname}/*`});e&&await Promise.all(e.map(async a=>{a.id&&await chrome.scripting.executeScript({target:{tabId:a.id},files:["assets/content.js"]})}))}async function r(){const t=await chrome.tabs.query({currentWindow:!0,active:!0}),e=structuredClone(o),a=await chrome.storage.local.get(["_global"]);if(a._global&&(e.global=a._global),!t.length||!t[0].id||!t[0].url)return e;try{await chrome.scripting.executeScript({target:{tabId:t[0].id},func:()=>!0})}catch{return e}const{hostname:s}=new URL(t[0].url);e.website.hostname=s;const i=await chrome.storage.local.get([s]);return i[s]&&(e.website=i[s]),e}async function c(t){if((t.website.hostname==="*"||t.website.mode==="global")&&await chrome.storage.local.set({_global:t.global}),t.website.hostname==="*")return;const e=await r();await chrome.storage.local.set({[e.website.hostname]:t.website}),await n(t)}chrome.runtime.onMessage.addListener((t,e,a)=>{if(e.id===chrome.runtime.id)switch(t.type){case"getSettings":return r().then(s=>a(s)),!0;case"saveSettings":c(t.payload);break;case"resetSettings":chrome.storage.local.clear().then(()=>n(o));break}});chrome.commands.onCommand.addListener(async t=>{if(t!=="toggle-dimmer")return;const e=await r();e&&(e.website.on=!e.website.on,await c(e))});
